const fs = require('fs');

const csvContent = fs.readFileSync('recife_novo.csv', 'utf8');
const lines = csvContent.split('\n').filter(line => line.trim() !== '');
const csvSequentials = lines.slice(1).map(line => {
    const parts = line.split(';');
    // Looking for the sequential column. Let's find its index first.
    return parts;
});

const header = lines[0].split(';');
const seqIndex = header.indexOf('sequencial');
console.log('Sequential Column Index:', seqIndex);

const allCsvSequentials = lines.slice(1).map(line => line.split(';')[seqIndex]).filter(s => s);

// List from step 682
const dbSequentials = ["1005243", "1005383", "1014803", "1034316", "1034332", "1034340", "1034359", "1035533", "1035541", "1035550", "1036050", "1036068", "1036076", "1036084", "1036092", "1036106", "1036114", "1036122", "1036130", "1036149", "1036157", "1036165", "1036173", "1036181", "1036190", "1128167", "1128183", "1143263", "1143409", "1143409", "1143417", "1175270", "1577514", "2318946", "3263550", "3263622", "3288218", "3288269", "3288323", "3293378", "3410579", "3459420", "4349067", "4349083", "4360915", "4365194", "4427912", "5013917", "5022711", "5024510", "5053064", "5053072", "5053943", "5053951", "5136105", "5136113", "5136121", "5136130", "5136148", "5367379", "5538343", "5633460", "5633516", "5633834", "5635314", "5781426", "5818966", "5819008", "5821215", "5821266", "5825229", "5826977", "5830028", "5831962", "5833132", "5833442", "5833450", "5833469", "5833477", "5833507", "5888255", "5888263", "5888271", "5888280", "5888298", "5888301", "5888310", "5888328", "5888336", "5891108", "5943728", "5943736", "5943744", "5946115", "5972418", "5972426", "5972434", "5972442", "5972450", "6149642", "6189105", "6194729", "6196209", "6242332", "6257089", "6257097", "6260330", "6260349", "6260373", "6260900", "6261086", "6461085", "6717543", "6828442", "6873308", "6873359", "6910033", "6947719", "6947727", "6959628", "7044186", "7061811", "7061820", "7083084", "7109377", "7123140", "7171455", "7180918", "7183089", "7185537", "7185545", "7190395", "7321775", "7539142", "7541643", "7556659", "7626860", "7708190", "8008060", "8010218", "8013225", "8046379", "8052468", "8080801", "8080810", "8080828", "8080836", "8080844", "8080852", "8080860", "8080879", "8080887", "8080895", "8080909", "8080917", "8080925", "8080933", "8083711", "8083738", "8083754", "8152667", "8199876", "8210462", "8211094", "8211108", "8320969", "8352216"];

const dbCounts = {};
dbSequentials.forEach(s => dbCounts[s] = (dbCounts[s] || 0) + 1);

const missing = [];
const csvCounts = {};

allCsvSequentials.forEach(s => {
    csvCounts[s] = (csvCounts[s] || 0) + 1;
});

Object.keys(csvCounts).forEach(s => {
    if (!dbCounts[s]) {
        missing.push({ sequential: s, status: 'missing' });
    } else if (dbCounts[s] < csvCounts[s]) {
        missing.push({ sequential: s, status: 'less_count', csv: csvCounts[s], db: dbCounts[s] });
    }
});

console.log('Missing/Under-counted Sequentials:', JSON.stringify(missing, null, 2));
